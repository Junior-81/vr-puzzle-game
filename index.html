<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <title>VR Puzzle Game</title>
    <style>
      /* Menu de sele√ß√£o de puzzle */
      #puzzle-menu {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.9);
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        font-family: Arial, sans-serif;
      }

      #puzzle-menu h3 {
        margin: 0 0 10px 0;
        color: #333;
        font-size: 16px;
      }

      #puzzle-menu button {
        display: block;
        width: 100%;
        margin: 5px 0;
        padding: 10px;
        border: none;
        border-radius: 5px;
        background: #4caf50;
        color: white;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.3s;
      }

      #puzzle-menu button:hover {
        background: #45a049;
      }

      #puzzle-menu button.reset {
        background: #ff9800;
      }

      #puzzle-menu button.reset:hover {
        background: #e68900;
      }

      #puzzle-menu button.rank {
        background: #2196f3;
      }

      #puzzle-menu button.rank:hover {
        background: #0b7dda;
      }

      #timer-display {
        margin-top: 10px;
        padding: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        font-size: 20px;
        color: white;
        text-align: center;
        font-weight: bold;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      #current-puzzle {
        margin-top: 10px;
        padding: 8px;
        background: #e3f2fd;
        border-radius: 5px;
        font-size: 12px;
        color: #1976d2;
        text-align: center;
      }

      #instructions {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.9);
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        font-family: Arial, sans-serif;
        font-size: 12px;
        max-width: 250px;
      }

      #instructions h4 {
        margin: 0 0 8px 0;
        color: #333;
        font-size: 14px;
      }

      #instructions p {
        margin: 5px 0;
        color: #555;
      }

      #instructions kbd {
        background: #f0f0f0;
        padding: 2px 6px;
        border-radius: 3px;
        border: 1px solid #ccc;
        font-family: monospace;
      }

      /* Modal de conclus√£o */
      #completion-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        justify-content: center;
        align-items: center;
      }

      #completion-modal.show {
        display: flex;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        max-width: 400px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .modal-content h2 {
        color: #4caf50;
        margin: 0 0 10px 0;
      }

      .modal-content p {
        font-size: 18px;
        margin: 15px 0;
      }

      .modal-content input {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        box-sizing: border-box;
      }

      .modal-content button {
        padding: 12px 30px;
        margin: 5px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .modal-content button.submit {
        background: #4caf50;
        color: white;
      }

      .modal-content button.submit:hover {
        background: #45a049;
      }

      /* Modal de ranking */
      #ranking-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        justify-content: center;
        align-items: center;
      }

      #ranking-modal.show {
        display: flex;
      }

      .ranking-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .ranking-content h2 {
        color: #2196f3;
        margin: 0 0 20px 0;
        text-align: center;
      }

      .ranking-tabs {
        display: flex;
        margin-bottom: 15px;
        border-bottom: 2px solid #ddd;
      }

      .ranking-tabs button {
        flex: 1;
        padding: 10px;
        border: none;
        background: none;
        cursor: pointer;
        font-size: 14px;
        color: #666;
        transition: all 0.3s;
      }

      .ranking-tabs button.active {
        color: #2196f3;
        border-bottom: 3px solid #2196f3;
        font-weight: bold;
      }

      .ranking-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .ranking-item {
        display: flex;
        justify-content: space-between;
        padding: 12px;
        margin: 8px 0;
        background: #f5f5f5;
        border-radius: 8px;
        align-items: center;
      }

      .ranking-item.top-1 {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      }

      .ranking-item.top-2 {
        background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
      }

      .ranking-item.top-3 {
        background: linear-gradient(135deg, #cd7f32 0%, #daa06d 100%);
      }

      .ranking-position {
        font-weight: bold;
        font-size: 18px;
        color: #333;
        margin-right: 10px;
      }

      .ranking-name {
        flex: 1;
        font-size: 16px;
        color: #333;
      }

      .ranking-time {
        font-weight: bold;
        color: #2196f3;
      }

      .close-ranking {
        display: block;
        margin: 20px auto 0;
        padding: 10px 30px;
        border: none;
        border-radius: 5px;
        background: #ff5252;
        color: white;
        font-size: 16px;
        cursor: pointer;
      }

      .close-ranking:hover {
        background: #ff1744;
      }
    </style>
  </head>
  <body>
    <!-- Menu de sele√ß√£o de puzzle -->
    <div id="puzzle-menu">
      <h3>üß© Escolha o Puzzle</h3>
      <button onclick="selectPuzzle(0)">Puzzle 1</button>
      <button onclick="selectPuzzle(1)">Puzzle 2</button>
      <button onclick="selectPuzzle(2)">Puzzle 3</button>
      <button class="reset" onclick="resetPuzzle()">üîÑ Resetar</button>
      <button class="rank" onclick="showRanking()">üèÜ Ranking</button>
      <div id="timer-display">‚è±Ô∏è 00:00</div>
      <div
        id="user-code-display"
        style="
          margin-top: 10px;
          padding: 8px;
          background: #fff3cd;
          border-radius: 5px;
          font-size: 11px;
          color: #856404;
        "
      >
        <strong>üë§ User:</strong> <span id="code-value">Carregando...</span>
      </div>
    </div>

    <!-- Instru√ß√µes -->
    <div id="instructions">
      <h4>üéÆ Controles:</h4>
      <p>üñ±Ô∏è <strong>Olhar:</strong> Mova o mouse</p>
      <p>üëÅÔ∏è <strong>Selecionar:</strong> Fixe o olhar</p>
      <p>üîÑ <strong>Rotacionar:</strong> Pressione <kbd>R</kbd></p>
      <p>
        <small
          >Mantenha <kbd>R</kbd> pressionado enquanto seleciona uma pe√ßa</small
        >
      </p>
    </div>

    <!-- Modal de conclus√£o -->
    <div id="completion-modal">
      <div class="modal-content">
        <h2>üéâ Parab√©ns!</h2>
        <p>Voc√™ completou o puzzle em:</p>
        <p
          style="font-size: 28px; color: #4caf50; font-weight: bold"
          id="final-time"
        >
          00:00
        </p>
        <p style="font-size: 14px; color: #666; margin: 10px 0">
          Salvando seu tempo no ranking...
        </p>
        <div>
          <button class="submit" onclick="submitScore()">
            üíæ Salvar e Continuar
          </button>
          <button onclick="closeModal()">‚ùå Fechar</button>
        </div>
      </div>
    </div>

    <!-- Modal de ranking -->
    <div id="ranking-modal">
      <div class="ranking-content">
        <h2>üèÜ Ranking de Jogadores</h2>
        <div class="ranking-tabs">
          <button class="active" onclick="showRankingTab(0)">Puzzle 1</button>
          <button onclick="showRankingTab(1)">Puzzle 2</button>
          <button onclick="showRankingTab(2)">Puzzle 3</button>
        </div>
        <ul class="ranking-list" id="ranking-list">
          <!-- Ser√° preenchido dinamicamente -->
        </ul>
        <button class="close-ranking" onclick="closeRanking()">Fechar</button>
      </div>
    </div>

    <a-scene id="scene">
      <a-sky color="#ECECEC"></a-sky>

      <a-plane
        rotation="-90 0 0"
        width="10"
        height="10"
        color="#c2c2c2"
        position="0 0 -5"
        shadow="receive: true"
      ></a-plane>

      <a-entity
        line-event
        id="line"
        line="start: 0 0 0; end: 0 0 0; color: red"
        transparent="true"
      ></a-entity>

      <a-text
        id="pieces-left"
        value="Area de remanejamento"
        color="#FF0000"
        position="-1.1 5.5 -5"
        width="5"
        rotation="30 0 0"
      ></a-text>

      <!-- Cron√¥metro 3D -->
      <a-entity id="timer-3d-container" position="0 5 -6">
        <a-plane
          width="2"
          height="0.6"
          color="#667eea"
          opacity="0.9"
          position="0 0 0"
        ></a-plane>
        <a-text
          id="timer-3d"
          value="‚è±Ô∏è 00:00"
          color="#FFFFFF"
          align="center"
          position="0 0 0.01"
          width="4"
        ></a-text>
      </a-entity>

      <!-- Modal 3D de Conclus√£o -->
      <a-entity id="completion-modal-3d" visible="false" position="0 2.5 -2">
        <!-- Fundo escuro semi-transparente -->
        <a-plane 
          width="3" 
          height="2.5" 
          color="#000000" 
          opacity="0.8"
          position="0 0 -0.1">
        </a-plane>
        
        <!-- Painel branco do modal -->
        <a-plane 
          width="2.8" 
          height="2.3" 
          color="#ffffff" 
          position="0 0 0">
        </a-plane>
        
        <!-- T√≠tulo -->
        <a-text 
          value="üéâ PARAB√âNS!" 
          align="center" 
          width="3"
          color="#4CAF50"
          position="0 0.8 0.01">
        </a-text>
        
        <!-- Mensagem -->
        <a-text 
          value="Voc√™ completou o quebra-cabe√ßa!" 
          align="center" 
          width="2.5"
          color="#333333"
          position="0 0.4 0.01">
        </a-text>
        
        <!-- Tempo Final -->
        <a-text 
          id="final-time-3d"
          value="Tempo: 00:00" 
          align="center" 
          width="2.5"
          color="#666666"
          position="0 0 0.01">
        </a-text>
        
        <!-- Bot√£o Enviar Pontua√ß√£o -->
        <a-entity position="0 -0.5 0.01">
          <a-plane 
            id="btn-submit-3d"
            class="clickable"
            puzzle-component="btn-submit-3d"
            width="1.8" 
            height="0.4" 
            color="#4CAF50">
          </a-plane>
          <a-text 
            value="üíæ Salvar e Continuar" 
            align="center" 
            width="2.2"
            color="#ffffff"
            position="0 0 0.01">
          </a-text>
        </a-entity>
        
        <!-- Bot√£o Fechar -->
        <a-entity position="0 -1.0 0.01">
          <a-plane 
            id="btn-close-3d"
            class="clickable"
            puzzle-component="btn-close-3d"
            width="1.2" 
            height="0.4" 
            color="#f44336">
          </a-plane>
          <a-text 
            value="‚ùå Fechar" 
            align="center" 
            width="2"
            color="#ffffff"
            position="0 0 0.01">
          </a-text>
        </a-entity>
      </a-entity>

      <a-entity camera wasd-controls look-controls position="0 2.6 0">
        <a-plane
          id="error"
          position="0 -0.5 -2"
          width="0.8"
          height="0.2"
          color="#FF0000"
          side="double"
          opacity="0.8"
          rotation="0 0 0"
          visible="false"
        >
          <a-text
            value="Erro no encaixe"
            color="#FFFFFF"
            position="-0.3 0 0.01"
            color="#8B0000"
            width="2"
          ></a-text>
        </a-plane>
        <!-- Texto de erro -->
        <a-entity
          cursor-ring
          raycaster="objects: .clickable"
          id="cursor"
          geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.02;"
          cursor="fuse: false"
          material="color: black; shader: flat"
          position="0 0 -1.5"
        >
        </a-entity>
      </a-entity>
    </a-scene>

    <script src="script.js"></script>
  </body>
</html>
